<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>gallery-model-sync-rest&#x2F;js&#x2F;model-sync-rest.js - YUI 3 Gallery</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0pr4&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0pr4&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><img src="..&#x2F;assets/css/logo.png"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ModelSync.REST.html">ModelSync.REST</a></li>
            
                <li><a href="..&#x2F;classes/ModelSync.YQL.html">ModelSync.YQL</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-model-sync-rest.html">gallery-model-sync-rest</a></li>
            
                <li><a href="..&#x2F;modules/gallery-model-sync-yql.html">gallery-model-sync-yql</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: gallery-model-sync-rest&#x2F;js&#x2F;model-sync-rest.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
An Extension which provides a RESTful HTTP sync implementation that can be mixed
into a Model or ModelList subclass.

@module gallery-model-sync-rest
**&#x2F;

&#x2F;**
An Extension which provides a RESTful HTTP sync implementation that can be mixed
into a Model or ModelList subclass.

This makes it trivial for your Model or ModelList subclasses communicate and
transmit JSON data via RESTful HTTP. In most cases you&#x27;ll only need to provide a
value for &#x60;root&#x60; when sub-classing Model, and only provide a value for &#x60;url&#x60;
when sub-classing ModelList.

    var User = Y.Base.create(&#x27;user&#x27;, Y.Model, [Y.ModelSync.REST], {
        root: &#x27;&#x2F;user&#x27;
    }, {
        ATTRS: {
            name: {}
        }
    });

    var Users = Y.Base.create(&#x27;users&#x27;, Y.ModelList, [Y.ModelSync.REST], {
        model: User,
        url  : &#x27;&#x2F;user&#x27;
    });

@class ModelSync.REST
@extensionfor Model
@extensionfor ModelList
**&#x2F;

var Lang = Y.Lang,

    sub        = Lang.sub,
    isValue    = Lang.isValue,
    isString   = Lang.isString,
    isNumber   = Lang.isNumber,
    isFunction = Lang.isFunction;

&#x2F;&#x2F; -- RESTSync -----------------------------------------------------------------

 function RESTSync() {}

&#x2F;**
Static hash lookup table of RESTful HTTP methods corresponding to CRUD actions.

@property HTTP_METHODS
@type Object
@default
    {
        &#x27;create&#x27;: &#x27;POST&#x27;,
        &#x27;read&#x27;  : &#x27;GET&#x27;,
        &#x27;update&#x27;: &#x27;PUT&#x27;,
        &#x27;delete&#x27;: &#x27;DELETE&#x27;
    }
@static
**&#x2F;
RESTSync.HTTP_METHODS = {
    &#x27;create&#x27;: &#x27;POST&#x27;,
    &#x27;read&#x27;  : &#x27;GET&#x27;,
    &#x27;update&#x27;: &#x27;PUT&#x27;,
    &#x27;delete&#x27;: &#x27;DELETE&#x27;
};

&#x2F;**
Default headers used with all XHRs.

These headers will be merged with any request-specific headers, and the request-
specific headers will take presidence.

@property HTTP_HEADERS
@type Object
@static
@default
    {
        &#x27;Accept&#x27;      : &#x27;application&#x2F;json&#x27;,
        &#x27;Content-Type&#x27;: &#x27;application&#x2F;json&#x27;
    }
**&#x2F;
RESTSync.HTTP_HEADERS = {
    &#x27;Accept&#x27;      : &#x27;application&#x2F;json&#x27;,
    &#x27;Content-Type&#x27;: &#x27;application&#x2F;json&#x27;
};

&#x2F;**
Default number of milliseconds before the XHR will timeout&#x2F;abort.

This can be overridden on a per-request basis.

@property HTTP_TIMEOUT
@type Number
@static
@default undefined
**&#x2F;

&#x2F;**
Static flag to use the HTTP POST method instead of PUT or DELETE.

If the server-side HTTP framework isn&#x27;t RESTful, setting this flag to &#x60;true&#x60;
will cause all PUT and DELETE requests to instead use the POST HTTP method, and
add a X-HTTP-Method-Override HTTP header with the value of the method type which
was overridden.

@property EMULATE_HTTP
@type Boolean
@default false
@static
**&#x2F;
RESTSync.EMULATE_HTTP = false;

&#x2F;**
Properties that shouldn&#x27;t be turned into ad-hoc attributes when passed to a
Model or ModelList constructor.

@property _NON_ATTRS_CFG
@type Array
@default [&#x27;url&#x27;]
@static
@protected
**&#x2F;
RESTSync._NON_ATTRS_CFG = [&#x27;url&#x27;];

RESTSync.prototype = {

    &#x2F;&#x2F; -- Public Properties ----------------------------------------------------

    &#x2F;**
    A String which represents the root or collection part of the URL space which
    relates to a Model or ModelList. Usually this value should be same for all
    instances of a specific Model&#x2F;ModelList type.

    When sub-classing Y.Model, most of the time you&#x27;ll want to just override
    this property, and let the URLs for the XHRs be generated by convention. If
    the &#x60;root&#x60; String ends with a trailing-slash, XHR URLs will also end with a
    &#x27;&#x2F;&#x27;; if the &#x60;root&#x60; does not end with a slash, neither will the XHR URLs.

    @example
        var User = Y.Base.create(&#x27;user&#x27;, Y.Model, [Y.ModelSync.REST], {
            root: &#x27;&#x2F;user&#x2F;&#x27;
        }, {
            ATTRS: {
                name: {}
            }
        });

        var myUser = new User({id: &#x27;123&#x27;});
        myUser.load(); &#x2F;&#x2F; Will GET the User data from: &#x2F;user&#x2F;123&#x2F;

        var newUser = new User({name: &#x27;Eric Ferraiuolo&#x27;});
        newUser.save(); &#x2F;&#x2F; Will POST the User data to: &#x2F;user&#x2F;

    When sub-classing Y.ModelList, usually you&#x27;ll want to ignore configuring the
    &#x60;root&#x60; and instead just set the &#x60;url&#x60; to a String; but if you just specify a
    value for &#x60;root&#x60;, things will work correctly.

    @property root
    @type String
    @default &quot;&quot;
    **&#x2F;
    root: &#x27;&#x27;,

    &#x2F;**
    A Function or String which is used to generate or specify the URL for the
    XHRs. While, this property can be defined for each Model&#x2F;ModelList instance,
    usually you&#x27;ll want to use a Function or String-pattern instead.

    If the &#x60;url&#x60; property is a Function, it should return the String that should
    be used as the URL. The Function will be called before each request and will
    be passed the sync &#x60;action&#x60; which is currently being performed.

    If the &#x60;url&#x60; property is a String, it will be processed by &#x60;Y.Lang.sub()&#x60;;
    this is useful when the URLs for a Model type match a specific pattern and
    can use simple replacement tokens:

    @example
        &#x27;&#x2F;user&#x2F;{id}&#x27;

    **Note:** String substitution on the &#x60;url&#x60; property will only happen for
    Y.Model subclasses, and only String and Number ATTR values will be
    substituted; do not expect something fancy to happen with Object, Array, or
    Boolean values; they will simply be ignored.

    When sub-classing Y.Model, you will probably be able to rely on the default
    implementation of &#x60;url()&#x60; which works in conjunction with the &#x60;root&#x60;
    property and whether the Model instance is new or not (i.e. has an &#x60;id&#x60;). If
    the &#x60;root&#x60; property ends with a trailing-slash, the generated URL for the
    specific Model instance will also end with a trailing-slash.

    If your URL-space has plural root or collection URLs, while the specific
    item resources are under a singular name, e.g. &#x2F;users (plural) and &#x2F;user&#x2F;123
    (singular); you&#x27;ll probably want to configure the &#x60;root&#x60; and &#x60;url&#x60;
    properties like this:

    @example
        var User = Y.Base.create(&#x27;user&#x27;, Y.Model, [Y.ModelSync.REST], {
            root: &#x27;&#x2F;users&#x27;,
            url : &#x27;&#x2F;user&#x2F;{id}&#x27;
        }, {
            ATTRS: {
                name: {}
            }
        });

        var myUser = new User({id: &#x27;123&#x27;});
        myUser.load(); &#x2F;&#x2F; Will GET the User data from: &#x2F;user&#x2F;123

        var newUser = new User({name: &#x27;Eric Ferraiuolo&#x27;});
        newUser.save(); &#x2F;&#x2F; Will POST the User data to: &#x2F;users

    When sub-classing Y.ModelList, you probably just need to specify a simple
    String for the &#x60;url&#x60; property and leave &#x60;root&#x60; to be the default value.

    @property url
    @type Function|String
    **&#x2F;
    url: function () {
        var root = this.root,
            url;

        if (this instanceof Y.ModelList || this.isNew()) {
            return root;
        }

        url = this.getAsURL(&#x27;id&#x27;);
        if (root &amp;&amp; root.charAt(root.length - 1) === &#x27;&#x2F;&#x27;) {
            &#x2F;&#x2F; Add trailing-slash because root has a trailing-slash.
            url += &#x27;&#x2F;&#x27;;
        }

        return this._joinURL(url);
    },

    &#x2F;&#x2F; -- Lifecycle Methods ----------------------------------------------------

    initializer: function (config) {
        config || (config = {});
        isValue(config.url) &amp;&amp; (this.url = config.url);
    },

    &#x2F;&#x2F; -- Public Methods -------------------------------------------------------

    &#x2F;**
    Communicates with a RESTful HTTP server by sending and receiving JSON data
    via XHRs.

    This method is called internally by load(), save(), and destroy().

    @method sync
    @param {String} action Sync action to perform. May be one of the following:

      * **create**: Store a newly-created model for the first time.
      * **read**  : Load an existing model.
      * **update**: Update an existing model.
      * **delete**: Delete an existing model.

    @param {Object} [options] Sync options.
      @param {Object} [options.headers] The HTTP headers to mix with the default
        headers specified by the &#x60;headers&#x60; property.
      @param {Number} [options.timeout] The number of milliseconds before the
        request will timeout and be aborted.
    @param {callback} [callback] Called when the sync operation finishes.
      @param {Error|null} callback.err If an error occurred, this parameter will
        contain the error. If the sync operation succeeded, _err_ will be
        falsy.
      @param {Any} [callback.response] The server&#x27;s response. This value will
        be passed to the parse() method, which is expected to parse it and
        return an attribute hash.
    **&#x2F;
    sync: function (action, options, callback) {
        options || (options = {});

        var url     = this._getURL(action),
            method  = RESTSync.HTTP_METHODS[action],
            headers = Y.merge(RESTSync.HTTP_HEADERS, options.headers),
            timeout = options.timeout || RESTSync.HTTP_TIMEOUT,
            entity;

        &#x2F;&#x2F; Prepare the content if we are sending data to the server.
        if (method === &#x27;POST&#x27; || method === &#x27;PUT&#x27;) {
            entity = this._serialize();
        } else {
            &#x2F;&#x2F; Remove header, no content is being sent.
            delete headers[&#x27;Content-Type&#x27;];
        }

        &#x2F;&#x2F; Setup HTTP emulation for older servers if we need it.
        if (RESTSync.EMULATE_HTTP &amp;&amp;
                (method === &#x27;PUT&#x27; || method === &#x27;DELETE&#x27;)) {

            &#x2F;&#x2F; Pass along original method type in the headers.
            headers[&#x27;X-HTTP-Method-Override&#x27;] = method;
            &#x2F;&#x2F; Fall-back to using POST method type.
            method = &#x27;POST&#x27;;
        }

        &#x2F;&#x2F; Setup and send the XHR.
        Y.io(url, {
            method : method,
            headers: headers,
            data   : entity,
            timeout: timeout,

            on: {
                success: function (txId, res) {
                    if (isFunction(callback)) {
                        callback(null, res.responseText);
                    }
                },

                failure: function (txId, res) {
                    if (isFunction(callback)) {
                        callback({
                            code: res.status,
                            msg : res.statusText
                        }, res.responseText);
                    }
                }
            }
        });
    },

    &#x2F;&#x2F; -- Protected Methods ----------------------------------------------------

    &#x2F;**
    Helper method to return the URL to use when making the XHR to the server.

    This method correctly handles variations of the &#x60;url&#x60; property&#x2F;method.

    @method _getURL
    @param {String} action Sync action to perform.
    @return {String} the URL for the XHR.
    @protected
    **&#x2F;
    _getURL: function (action) {
        var url = this.url,
            data;

        if (isFunction(url)) {
            return this.url(action);
        }

        if (this instanceof Y.Model) {
            data = {};

            Y.Object.each(this.toJSON(), function (v, k) {
                if (isString(v) || isNumber(v)) {
                    &#x2F;&#x2F; URL-encode any String or Number values.
                    data[k] = encodeURIComponent(v);
                }
            });

            &#x2F;&#x2F; Substitute placeholders with the URL-encoded data values.
            url = sub(url, data);
        }

        return url || this.root;
    },

    &#x2F;**
    Joins the &#x60;root&#x60; URL to the specified _url_, normalizing leading&#x2F;trailing
    &#x60;&#x2F;&#x60; characters.

    Copied from YUI 3&#x27;s &#x60;Y.Controller&#x60; Class: by Ryan Grove (Yahoo! Inc.)
    https:&#x2F;&#x2F;github.com&#x2F;yui&#x2F;yui3&#x2F;blob&#x2F;master&#x2F;src&#x2F;app&#x2F;js&#x2F;controller.js

    @example
        model.root = &#x27;&#x2F;foo&#x27;
        model._joinURL(&#x27;bar&#x27;);  &#x2F;&#x2F; =&gt; &#x27;&#x2F;foo&#x2F;bar&#x27;
        model._joinURL(&#x27;&#x2F;bar&#x27;); &#x2F;&#x2F; =&gt; &#x27;&#x2F;foo&#x2F;bar&#x27;

        model.root = &#x27;&#x2F;foo&#x2F;&#x27;
        model._joinURL(&#x27;bar&#x27;);  &#x2F;&#x2F; =&gt; &#x27;&#x2F;foo&#x2F;bar&#x27;
        model._joinURL(&#x27;&#x2F;bar&#x27;); &#x2F;&#x2F; =&gt; &#x27;&#x2F;foo&#x2F;bar&#x27;

    @method _joinURL
    @param {String} url URL to append to the &#x60;root&#x60; URL.
    @return {String} Joined URL.
    @protected
    **&#x2F;
    _joinURL: function (url) {
        var root = this.root;

        if (url.charAt(0) === &#x27;&#x2F;&#x27;) {
            url = url.substring(1);
        }

        return root &amp;&amp; root.charAt(root.length - 1) === &#x27;&#x2F;&#x27; ?
                root + url :
                root + &#x27;&#x2F;&#x27; + url;
    },

    &#x2F;**
    Serializes &#x60;this&#x60; model to be used as the HTTP request entity body. By
    default this model will be serialized to a JSON string via its &#x60;toJSON()&#x60;
    method.

    You can override this method when the HTTP server expects a different
    representation of this model&#x27;s data that is different from the default JSON
    serialization.

    **Note:** A model&#x27;s &#x60;toJSON()&#x60; method can also be overridden; if you just
    need to modify which attributes are serialized to JSON, that&#x27;s a better
    place to start.

    @method _serialize
    @return {String} serialized HTTP request entity body
    @protected
    **&#x2F;
    _serialize: function () {
        return Y.JSON.stringify(this);
    }
};

&#x2F;&#x2F; -- Namespace ----------------------------------------------------------------

Y.namespace(&#x27;ModelSync&#x27;).REST = RESTSync;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<!--script src="..&#x2F;assets/js/tabs.js"></script-->
<script src="..&#x2F;assets/../api.js"></script>


<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
